<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Book Studio Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.js"></script>

<style>
:root {
    --sidebar-width: 280px;
    --primary-bg: #121212;
    --accent: #2ecc71;
}

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: var(--primary-bg);
    color: #e0e0e0;
    display: flex;
    height: 100vh;
    overflow: hidden;
}

#sidebar {
    width: var(--sidebar-width);
    background: #1e1e1e;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    border-right: 1px solid #333;
    overflow-y: auto;
}

.section { border-bottom: 1px solid #333; padding-bottom: 15px; }

h3 {
    color: var(--accent);
    font-size: 0.75rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

input, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    background: #252525;
    color: white;
    border: 1px solid #444;
    border-radius: 4px;
}

button {
    background: var(--accent);
    color: #000;
    font-weight: bold;
    cursor: pointer;
}

#main-view {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle, #2c2c2c 0%, #000 100%);
}

#book-viewport {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

#flipbook {
    transform-origin: center center;
    transition: transform 0.2s ease;
}

.page-content {
    background: #fff;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}

#branding-overlay {
    position: absolute;
    top: 15px;
    right: 20px;
    display: flex;
    gap: 15px;
    z-index: 50;
}

.brand-img {
    height: 60px;
    background: #fff;
    border-radius: 4px;
    border: 1px solid #555;
    object-fit: contain;
    display: none;
}

#controls {
    position: absolute;
    bottom: 20px;
    width: 60%;
    background: rgba(0,0,0,0.6);
    padding: 10px;
    border-radius: 50px;
    text-align: center;
}

#loading-msg {
    position: absolute;
    color: var(--accent);
    font-size: 1.2rem;
    display: none;
}
</style>
</head>

<body>

<aside id="sidebar">

<div class="section">
    <h3>1. Arquivo</h3>
    <input type="file" id="pdfInput" accept="application/pdf">
</div>

<div class="section">
    <h3>2. Aparência</h3>
    <label>Cor de Fundo</label>
    <input type="color" value="#121212"
        onchange="document.getElementById('main-view').style.background=this.value">
    <label>Zoom</label>
    <input type="range" id="zoom" min="0.6" max="1.4" step="0.05" value="1">
</div>

<div class="section">
    <h3>3. Identidade</h3>
    <input type="file" accept="image/*" onchange="loadImg(this,'logo')">
    <input type="file" accept="image/*" onchange="loadImg(this,'qr')">
</div>

<div class="section">
    <h3>4. Links</h3>
    <input type="text" id="lName" placeholder="Nome">
    <input type="text" id="lUrl" placeholder="https://">
    <button onclick="addLink()">Adicionar</button>
    <div id="links-list"></div>
</div>

</aside>

<main id="main-view">

<div id="loading-msg">Carregando PDF...</div>

<div id="branding-overlay">
    <img id="logo" class="brand-img">
    <img id="qr" class="brand-img">
</div>

<div id="book-viewport">
    <div id="flipbook"></div>
</div>

<div id="controls">
    <input type="range" id="progress-bar" value="0">
    <div id="page-info"></div>
</div>

</main>

<script>
const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

let flipBook = null;
let currentPdf = null;

const PDF_PADRAO = 'MEU EBOOK.pdf';

/* ===== AUTOLOAD ===== */
window.addEventListener('DOMContentLoaded', () => {
    loadPDF(PDF_PADRAO, true);
});

document.getElementById('pdfInput').onchange = e => {
    const file = e.target.files[0];
    if (file) loadPDF(URL.createObjectURL(file), false);
};

/* ===== LOAD ===== */
async function loadPDF(src, persist) {
    document.getElementById('loading-msg').style.display = 'block';

    const task = pdfjsLib.getDocument(src);
    currentPdf = await task.promise;
    await renderPDF();

    document.getElementById('loading-msg').style.display = 'none';
}

/* ===== RENDER ===== */
async function renderPDF() {
    const container = document.getElementById('flipbook');
    container.innerHTML = '';

    const maxHeight = window.innerHeight * 0.75;

    for (let i = 1; i <= currentPdf.numPages; i++) {
        const page = await currentPdf.getPage(i);
        const viewport = page.getViewport({ scale: 1 });
        const scale = maxHeight / viewport.height;
        const scaled = page.getViewport({ scale });

        const canvas = document.createElement('canvas');
        canvas.width = scaled.width;
        canvas.height = scaled.height;
        canvas.className = 'page-content';

        await page.render({
            canvasContext: canvas.getContext('2d'),
            viewport: scaled
        }).promise;

        container.appendChild(canvas);
    }
    startFlip();
}

/* ===== PAGE FLIP ===== */
function startFlip() {
    if (flipBook) flipBook.destroy();

    const first = document.querySelector('.page-content');

    flipBook = new St.PageFlip(document.getElementById('flipbook'), {
        width: first.width,
        height: first.height,
        size: "fixed",
        autoSize: true,
        showCover: true
    });

    flipBook.loadFromHTML(document.querySelectorAll('.page-content'));
    document.getElementById('progress-bar').max = currentPdf.numPages - 1;

    flipBook.on('flip', e => {
        document.getElementById('progress-bar').value = e.data;
        document.getElementById('page-info').innerText =
        `Página ${e.data + 1} de ${currentPdf.numPages}`;
    });
}

/* ===== ZOOM ===== */
document.getElementById('zoom').addEventListener('input', e => {
    document.getElementById('flipbook').style.transform =
    `scale(${e.target.value})`;
});

/* ===== PROGRESS ===== */
document.getElementById('progress-bar').oninput = e => {
    if (flipBook) flipBook.turnToPage(+e.target.value);
};

/* ===== BRANDING ===== */
function loadImg(input,id){
    const f = input.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = e => {
        const img = document.getElementById(id);
        img.src = e.target.result;
        img.style.display = 'block';
    };
    r.readAsDataURL(f);
}

/* ===== LINKS ===== */
function addLink(){
    if(!lName.value || !lUrl.value) return;
    const a = document.createElement('a');
    a.href = lUrl.value;
    a.target = "_blank";
    a.innerHTML =
    `<button style="background:#333;font-size:11px;margin-top:5px">${lName.value}</button>`;
    document.getElementById('links-list').appendChild(a);
}
</script>

</body>
</html>
